!function(t){var o={};function e(i){if(o[i])return o[i].exports;var a=o[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,e),a.l=!0,a.exports}e.m=t,e.c=o,e.d=function(t,o,i){e.o(t,o)||Object.defineProperty(t,o,{enumerable:!0,get:i})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,o){if(1&o&&(t=e(t)),8&o)return t;if(4&o&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(e.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&o&&"string"!=typeof t)for(var a in t)e.d(i,a,function(o){return t[o]}.bind(null,a));return i},e.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(o,"a",o),o},e.o=function(t,o){return Object.prototype.hasOwnProperty.call(t,o)},e.p="",e(e.s=6)}([function(t,o,e){"use strict";var i=e(2),a=e(1),n=e(3);o.a=function(t){function o(){}return o.prototype.modulePostCreated=function(o){a.a.close();var e=i.a.isEditingModule(),d={action:"get_post",id:o};t.post(ajaxurl,d,(function(t){var o={post_id:t.ID,title:t.post_title};i.a.updateModule(e,o),n.a.save("form")}),"json")},new o}(jQuery)},function(t,o,e){"use strict";o.a=function(t){function o(){this.handleEvents()}return o.prototype.open=function(o){t("body").addClass("modularity-modal-open").append('            <div id="modularity-modal">                <div class="modularity-modal-wrapper">                    <button class="modularity-modal-close" data-modularity-modal-action="close">&times; '+modularityAdminLanguage.close+'</button>                    <div class="modularity-modal-spinner-container" id="modularity-iframe-loader"><span class="modularity-modal-spinner"></span></div>                    <iframe class="modularity-modal-iframe" src="'+o+'" frameborder="0" onload="document.getElementById(\'modularity-iframe-loader\').style.display=\'none\';" allowtransparency></iframe>                </div>            </div>        '),!0},o.prototype.close=function(){t("body").removeClass("modularity-modal-open"),t("#modularity-modal").remove(),!1},o.prototype.handleEvents=function(){t(document).on("click",'[data-modularity-modal-action="close"]',function(t){t.preventDefault(),this.close()}.bind(this))},new o}(jQuery)},function(t,o,e){"use strict";var i=e(0),a=e(5),n=e.n(a),d=e(1);o.a=function(t){var o={is_thickbox:!0},e=!1;function a(){t(function(){"undefined"!=typeof pagenow&&"admin_page_modularity-editor"==pagenow&&(this.handleEvents(),this.loadModules(modularity_post_id))}.bind(this))}return a.prototype.loadModules=function(o){var e={action:"get_post_modules",id:o};t.post(ajaxurl,e,function(o){t.each(o,function(o,e){var i=t('.modularity-sidebar-area[data-area-id="'+o+'"]');t.each(e.modules,function(o,e){"true"==e.hidden&&(e.hidden=!0);var a=void 0===e.sidebar_incompability||t.isEmptyObject(e.sidebar_incompability)?"":JSON.stringify(e.sidebar_incompability);this.addModule(i,e.post_type,e.post_type_name,e.post_title,e.ID,e.hidden,e.columnWidth,e.isDeprecated,a)}.bind(this)),i.removeClass("modularity-spinner")}.bind(this)),this.initCompleted=!0,t(".modularity-sidebar-area").removeClass("modularity-spinner")}.bind(this),"json")},a.prototype.isEditingModule=function(){return e},a.prototype.getThickBoxUrl=function(e,i){var a="",n={};switch(e){case"add":a="post-new.php";break;case"edit":a="post.php"}return"number"==typeof i.postId&&(n.post=i.postId,n.action="edit"),"string"==typeof i.postType&&(n.post_type=i.postType),admin_url+a+"?"+t.param(n)+"&"+t.param(o)},a.prototype.getImportUrl=function(e){var i={};return i.post_type=e.postType,admin_url+"edit.php?"+t.param(i)+"&"+t.param(o)},a.prototype.addModule=function(o,e,a,d,r,l,s,u,p){d=void 0!==d?": "+d:"",r=void 0!==r?r:"",s=void 0!==s?s:"",deprecated=!0===u?'<span class="modularity-deprecated" style="color:#ff0000;">('+modularityAdminLanguage.deprecated+")</span>":"",p=void 0!==p?p:"";var c=this.getThickBoxUrl("add",{postType:e});i.a.postAction="add",r&&(c=this.getThickBoxUrl("edit",{postId:r}),i.a.postAction="edit");var m=this.getImportUrl({postType:e}),y="";!0===l&&(y="checked");var f=t(o).data("area-id"),h=n.a.uuid(),v='<li id="post-'+r+'" data-module-id="'+e+'" data-module-stored-width="'+s+"\" data-sidebar-incompability='"+p+'\'>                <span class="modularity-line-wrapper">                    <span class="modularity-sortable-handle"></span>                    <span class="modularity-module-name">                        '+a+"                        "+deprecated+'                        <span class="modularity-module-title">'+d+'</span>                        <label class="modularity-module-hide">                            <input type="checkbox" name="modularity_modules['+f+"]["+h+'][hidden]" value="hidden" '+y+" />                            "+modularityAdminLanguage.langhide+'                        </label>                    </span>                    <span class="modularity-module-columns">                        <label>'+modularityAdminLanguage.width+':</label>                        <select name="modularity_modules['+f+"]["+h+'][columnWidth]">                            '+modularityAdminLanguage.widthOptions+'                        </select>                    </span>                    <span class="modularity-module-actions">                        <a href="'+c+'" data-modularity-modal class="modularity-js-thickbox-open"><span>'+modularityAdminLanguage.langedit+'</span></a>                        <a href="'+m+'" class="modularity-js-thickbox-import"><span>'+modularityAdminLanguage.langimport+'</span></a>                        <a href="#remove" class="modularity-module-remove"><span>'+modularityAdminLanguage.langremove+'</span></a>                    </span>                    <input type="hidden" name="modularity_modules['+f+"]["+h+'][postid]" class="modularity-js-module-id" value="'+r+'" required>                </span>            </li>';t(o).append(v),t(".modularity-sidebar-area > li").each((function(o,e){t(".modularity-module-columns select",t(e)).val(t(e).attr("data-module-stored-width"))})),t(".modularity-js-sortable").sortable("refresh")},a.prototype.updateModule=function(t,o){t.find("a.modularity-js-thickbox-open").attr("href",this.getThickBoxUrl("edit",{postId:o.post_id})),t.find("input.modularity-js-module-id").val(o.post_id).change(),t.find(".modularity-module-title").text(": "+o.title)},a.prototype.removeModule=function(t){confirm(modularityAdminLanguage.actionRemove)&&t.remove()},a.prototype.handleEvents=function(){t(document).on("click",".modularity-module-remove",function(o){o.preventDefault();var e=t(o.target).closest("li");this.removeModule(e)}.bind(this)),t(document).on("click",".modularity-js-thickbox-import",(function(o){o.preventDefault();t(o.target).closest("a");e=t(o.target).closest("li"),i.a.postAction="import",d.a.open(t(o.target).closest("a").attr("href"))})),t(document).on("click",".modularity-js-thickbox-open",function(o){o.preventDefault(),t(o.target).closest("a").attr("href").indexOf("post.php")>-1&&(i.a.postAction="edit"),e=t(o.target).closest("li"),d.a.open(t(o.target).closest("a").attr("href"))}.bind(this))},new a}(jQuery)},function(t,o,e){"use strict";o.a=function(t){function o(){t(function(){}.bind(this))}return o.prototype.save=function(o){t("#modularity-options #publishing-action .spinner").css("visibility","visible");var e=t(o).serializeObject();e.id=modularity_post_id,e.action="save_modules",t.post(ajaxurl,e,(function(o){t("#modularity-options #publishing-action .spinner").css("visibility","hidden")}))},new o}(jQuery)},function(t,o,e){"use strict";var i=e(0),a=e(2),n=e(1);o.a=function(t){var o=!1;function e(){t(function(){t(document).on("click",".modularity-js-thickbox-widget-import-widget",(function(e){e.preventDefault(),o=t(e.target).parents(".widget-inside");var d=a.a.getImportUrl({postType:t(e.target).parents(".widget-inside").find(".modularity-widget-module-type select").val()});a.a.editingModule=t(e.target).closest(".widget-inside"),i.a.postAction="import-widget",n.a.open(d)})),t(document).on("click",".modularity-js-thickbox-open-widget",function(o){o.preventDefault(),t(o.target).closest("a").attr("href").indexOf("post.php")>-1&&(i.a.postAction="edit");t(o.target).closest("li");n.a.open(t(o.target).closest("a").attr("href"))}.bind(this))}.bind(this))}return e.prototype.isEditingWidget=function(){return o},e.prototype.updateWidget=function(o,e){t(o).find(".modularity-widget-module-id-span").html(e.post_id),t(o).find(".modularity-widget-module-id").val(e.post_id),t(o).find(".modularity-widget-module-edit").attr("href","post.php?post="+e.post_id+"&action=edit&is_thickbox=true").removeClass("hidden"),t(o).find(".modularity-widget-module-title-span").html(e.title),t(o).find(".modularity-widget-module-title").val(e.title)},new e}(jQuery)},function(t,o){t.exports((function(t){function o(){t(function(){}.bind(this))}return o.prototype.uuid=function(t){return Math.random().toString(36).substr(2,9)},new o}))(jQuery)},function(t,o,e){"use strict";e.r(o);var i,a=e(0),n=e(2),d=e(3),r=e(1),l=e(4);o.default=(i=jQuery,"add"==a.a.postAction&&""==modularity_post_action&&a.a.modulePostCreated(modularity_post_id),"edit-inline-saved"==a.a.postAction&&parent.location.reload(),"edit"==a.a.postAction&&""==modularity_post_action&&jQuery(document).on("click","#publish",(function(t){a.a.postAction="add"})),"edit-inline-not-saved"==a.a.postAction&&jQuery(document).on("click","#publish",(function(t){a.a.postAction="edit-inline-saved"})),"import"==a.a.postAction&&(i('.check-column input[type="checkbox"]').remove(),i(".wp-list-table").addClass("modularity-wp-list-table"),i("tbody .check-column").addClass("modularity-import-column").append('<button class="button modularity-import-button" data-modularity-action="import">Import</button>'),i("#posts-filter").append('<input type="hidden" name="is_thickbox" value="true">'),i(document).on("click",'[data-modularity-action="import"]',(function(t){t.preventDefault();var o=i(t.target).closest("tr").attr("id");o=o.split("-")[1];var e=n.a.isEditingModule(),a={action:"get_post",id:o};i("body").addClass("modularity-loader-takeover"),i.post(ajaxurl,a,(function(t){var o={post_id:t.ID,title:t.post_title};n.a.updateModule(e,o),d.a.save("form"),r.a.close()}),"json")}))),void("import-widget"==a.a.postAction&&(i('.check-column input[type="checkbox"]').remove(),i(".wp-list-table").addClass("modularity-wp-list-table"),i("tbody .check-column").addClass("modularity-import-column").append('<button class="button modularity-import-button" data-modularity-action="import">Import</button>'),i(document).on("click",'[data-modularity-action="import"]',(function(t){t.preventDefault();var o=i(t.target).closest("tr").attr("id");o=o.split("-")[1];var e=l.a.isEditingWidget(),a={action:"get_post",id:o};i("body").addClass("modularity-loader-takeover"),i.post(ajaxurl,a,(function(t){var o={post_id:t.ID,title:t.post_title};l.a.updateWidget(e,o),r.a.close()}),"json")})))))}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc291cmNlL2pzL2VkaXRvci90aGlja2JveC5qcyIsIndlYnBhY2s6Ly8vLi9zb3VyY2UvanMvcHJvbXB0L21vZGFsLmpzIiwid2VicGFjazovLy8uL3NvdXJjZS9qcy9lZGl0b3IvbW9kdWxlLmpzIiwid2VicGFjazovLy8uL3NvdXJjZS9qcy9lZGl0b3IvYXV0b3NhdmUuanMiLCJ3ZWJwYWNrOi8vLy4vc291cmNlL2pzL2hlbHBlcnMvd2lkZ2V0LmpzIiwid2VicGFjazovLy8uL3NvdXJjZS9qcy9oZWxwZXJzL2hlbHBlcnMuanMiLCJ3ZWJwYWNrOi8vLy4vc291cmNlL2pzL21vZHVsYXJpdHktZWRpdG9yLW1vZGFsLmpzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiJCIsIlRoaWNrYm94IiwibW9kdWxlUG9zdENyZWF0ZWQiLCJwb3N0SWQiLCJNb2RhbCIsImNsb3NlIiwiTW9kdWxlIiwiaXNFZGl0aW5nTW9kdWxlIiwicmVxdWVzdCIsImFjdGlvbiIsImlkIiwicG9zdCIsImFqYXh1cmwiLCJyZXNwb25zZSIsImRhdGEiLCJwb3N0X2lkIiwiSUQiLCJ0aXRsZSIsInBvc3RfdGl0bGUiLCJ1cGRhdGVNb2R1bGUiLCJBdXRvc2F2ZSIsInNhdmUiLCJqUXVlcnkiLCJ0aGlzIiwiaGFuZGxlRXZlbnRzIiwib3BlbiIsInVybCIsImFkZENsYXNzIiwiYXBwZW5kIiwibW9kdWxhcml0eUFkbWluTGFuZ3VhZ2UiLCJyZW1vdmVDbGFzcyIsInJlbW92ZSIsImRvY3VtZW50Iiwib24iLCJlIiwicHJldmVudERlZmF1bHQiLCJ0aGlja2JveE9wdGlvbnMiLCJpc190aGlja2JveCIsImVkaXRpbmdNb2R1bGUiLCJwYWdlbm93IiwibG9hZE1vZHVsZXMiLCJtb2R1bGFyaXR5X3Bvc3RfaWQiLCJlYWNoIiwic2lkZWJhciIsInNpZGViYXJFbGVtZW50IiwiaGlkZGVuIiwiaW5jb21wYWJpbGl0eSIsInNpZGViYXJfaW5jb21wYWJpbGl0eSIsImlzRW1wdHlPYmplY3QiLCJKU09OIiwic3RyaW5naWZ5IiwiYWRkTW9kdWxlIiwicG9zdF90eXBlIiwicG9zdF90eXBlX25hbWUiLCJjb2x1bW5XaWR0aCIsImlzRGVwcmVjYXRlZCIsImluaXRDb21wbGV0ZWQiLCJnZXRUaGlja0JveFVybCIsImJhc2UiLCJxdWVyeXN0cmluZyIsInBvc3RUeXBlIiwiYWRtaW5fdXJsIiwicGFyYW0iLCJnZXRJbXBvcnRVcmwiLCJ0YXJnZXQiLCJtb2R1bGVOYW1lIiwibW9kdWxlVGl0bGUiLCJkZXByZWNhdGVkIiwidGhpY2tib3hVcmwiLCJwb3N0QWN0aW9uIiwiaW1wb3J0VXJsIiwiaXNIaWRkZW4iLCJzaWRlYmFySWQiLCJpdGVtUm93SWQiLCJIZWxwZXJzIiwidXVpZCIsImh0bWwiLCJsYW5naGlkZSIsIndpZHRoIiwid2lkdGhPcHRpb25zIiwibGFuZ2VkaXQiLCJsYW5naW1wb3J0IiwibGFuZ3JlbW92ZSIsImluZGV4IiwiaXRlbSIsInZhbCIsImF0dHIiLCJzb3J0YWJsZSIsImZpbmQiLCJjaGFuZ2UiLCJ0ZXh0IiwicmVtb3ZlTW9kdWxlIiwiY29uZmlybSIsImFjdGlvblJlbW92ZSIsImNsb3Nlc3QiLCJpbmRleE9mIiwic2VsZWN0b3IiLCJjc3MiLCJzZXJpYWxpemVPYmplY3QiLCJlZGl0aW5nV2lkZ2V0IiwiV2lkZ2V0IiwicGFyZW50cyIsImlzRWRpdGluZ1dpZGdldCIsInVwZGF0ZVdpZGdldCIsIndpZGdldCIsInNlcGFyYXRvciIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInN1YnN0ciIsIm1vZHVsYXJpdHlfcG9zdF9hY3Rpb24iLCJwYXJlbnQiLCJsb2NhdGlvbiIsInJlbG9hZCIsInNwbGl0Il0sIm1hcHBpbmdzIjoiYUFDRSxJQUFJQSxFQUFtQixHQUd2QixTQUFTQyxFQUFvQkMsR0FHNUIsR0FBR0YsRUFBaUJFLEdBQ25CLE9BQU9GLEVBQWlCRSxHQUFVQyxRQUduQyxJQUFJQyxFQUFTSixFQUFpQkUsR0FBWSxDQUN6Q0csRUFBR0gsRUFDSEksR0FBRyxFQUNISCxRQUFTLElBVVYsT0FOQUksRUFBUUwsR0FBVU0sS0FBS0osRUFBT0QsUUFBU0MsRUFBUUEsRUFBT0QsUUFBU0YsR0FHL0RHLEVBQU9FLEdBQUksRUFHSkYsRUFBT0QsUUFLZkYsRUFBb0JRLEVBQUlGLEVBR3hCTixFQUFvQlMsRUFBSVYsRUFHeEJDLEVBQW9CVSxFQUFJLFNBQVNSLEVBQVNTLEVBQU1DLEdBQzNDWixFQUFvQmEsRUFBRVgsRUFBU1MsSUFDbENHLE9BQU9DLGVBQWViLEVBQVNTLEVBQU0sQ0FBRUssWUFBWSxFQUFNQyxJQUFLTCxLQUtoRVosRUFBb0JrQixFQUFJLFNBQVNoQixHQUNYLG9CQUFYaUIsUUFBMEJBLE9BQU9DLGFBQzFDTixPQUFPQyxlQUFlYixFQUFTaUIsT0FBT0MsWUFBYSxDQUFFQyxNQUFPLFdBRTdEUCxPQUFPQyxlQUFlYixFQUFTLGFBQWMsQ0FBRW1CLE9BQU8sS0FRdkRyQixFQUFvQnNCLEVBQUksU0FBU0QsRUFBT0UsR0FFdkMsR0FEVSxFQUFQQSxJQUFVRixFQUFRckIsRUFBb0JxQixJQUMvQixFQUFQRSxFQUFVLE9BQU9GLEVBQ3BCLEdBQVcsRUFBUEUsR0FBOEIsaUJBQVZGLEdBQXNCQSxHQUFTQSxFQUFNRyxXQUFZLE9BQU9I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U0ssWUFHcEJrRixJQUFPRyxhQUFhQyxFQUFRMUYsR0FDNUJWLElBQU1DLFVBRVAiLCJmaWxlIjoianMvbW9kdWxhcml0eS1lZGl0b3ItbW9kYWwubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDYpO1xuIiwiaW1wb3J0IE1vZHVsZSBmcm9tICcuL21vZHVsZS5qcyc7XG5pbXBvcnQgTW9kYWwgZnJvbSAnLi4vcHJvbXB0L21vZGFsLmpzJztcbmltcG9ydCBBdXRvc2F2ZSBmcm9tICcuL2F1dG9zYXZlLmpzJztcblxuIGV4cG9ydCBkZWZhdWx0IChmdW5jdGlvbiAoJCkge1xuXG4gICAgLyoqXG4gICAgICogQXR0ZW50aW9uOiBUaGlzIHZhcmlhYmxlIHNob3VsZCBub3QgYmUgc2V0IG1hbnVhbGx5XG4gICAgICpcbiAgICAgKiBJbmRpY2F0ZXMgaWYgd2UgYXJlIGFkZGluZyBhIG5ldyBwb3N0IG9yIGVkaXRpbmcgb2xkIG9uZVxuICAgICAqIEB0eXBlIHtTdHJpbmd9XG4gICAgICovXG4gICAgdmFyIHBvc3RBY3Rpb24gPSAnYWRkJztcblxuICAgIGZ1bmN0aW9uIFRoaWNrYm94KCkge1xuXG4gICAgfVxuXG4gICAgVGhpY2tib3gucHJvdG90eXBlLm1vZHVsZVBvc3RDcmVhdGVkID0gZnVuY3Rpb24gKHBvc3RJZCkge1xuICAgICAgICBNb2RhbC5jbG9zZSgpO1xuXG4gICAgICAgIHZhciBtb2R1bGUgPSBNb2R1bGUuaXNFZGl0aW5nTW9kdWxlKCk7XG5cbiAgICAgICAgdmFyIHJlcXVlc3QgPSB7XG4gICAgICAgICAgICBhY3Rpb246ICdnZXRfcG9zdCcsXG4gICAgICAgICAgICBpZDogcG9zdElkXG4gICAgICAgIH07XG5cbiAgICAgICAgJC5wb3N0KGFqYXh1cmwsIHJlcXVlc3QsIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgdmFyIGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgcG9zdF9pZDogcmVzcG9uc2UuSUQsXG4gICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLnBvc3RfdGl0bGVcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIE1vZHVsZS51cGRhdGVNb2R1bGUobW9kdWxlLCBkYXRhKTtcbiAgICAgICAgICAgIEF1dG9zYXZlLnNhdmUoJ2Zvcm0nKTtcbiAgICAgICAgfSwgJ2pzb24nKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIG5ldyBUaGlja2JveCgpO1xuXG59KShqUXVlcnkpO1xuIiwiZXhwb3J0IGRlZmF1bHQgIChmdW5jdGlvbiAoJCkge1xuXG4gICAgdmFyIGlzT3BlbiA9IGZhbHNlO1xuXG4gICAgZnVuY3Rpb24gTW9kYWwoKSB7XG4gICAgICAgIHRoaXMuaGFuZGxlRXZlbnRzKCk7XG4gICAgfVxuXG4gICAgTW9kYWwucHJvdG90eXBlLm9wZW4gPSBmdW5jdGlvbiAodXJsKSB7XG4gICAgICAgICQoJ2JvZHknKS5hZGRDbGFzcygnbW9kdWxhcml0eS1tb2RhbC1vcGVuJykuYXBwZW5kKCdcXFxuICAgICAgICAgICAgPGRpdiBpZD1cIm1vZHVsYXJpdHktbW9kYWxcIj5cXFxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJtb2R1bGFyaXR5LW1vZGFsLXdyYXBwZXJcIj5cXFxuICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPVwibW9kdWxhcml0eS1tb2RhbC1jbG9zZVwiIGRhdGEtbW9kdWxhcml0eS1tb2RhbC1hY3Rpb249XCJjbG9zZVwiPiZ0aW1lczsgJyArIG1vZHVsYXJpdHlBZG1pbkxhbmd1YWdlLmNsb3NlICsgJzwvYnV0dG9uPlxcXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJtb2R1bGFyaXR5LW1vZGFsLXNwaW5uZXItY29udGFpbmVyXCIgaWQ9XCJtb2R1bGFyaXR5LWlmcmFtZS1sb2FkZXJcIj48c3BhbiBjbGFzcz1cIm1vZHVsYXJpdHktbW9kYWwtc3Bpbm5lclwiPjwvc3Bhbj48L2Rpdj5cXFxuICAgICAgICAgICAgICAgICAgICA8aWZyYW1lIGNsYXNzPVwibW9kdWxhcml0eS1tb2RhbC1pZnJhbWVcIiBzcmM9XCInICsgdXJsICsgJ1wiIGZyYW1lYm9yZGVyPVwiMFwiIG9ubG9hZD1cImRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFxcJ21vZHVsYXJpdHktaWZyYW1lLWxvYWRlclxcJykuc3R5bGUuZGlzcGxheT1cXCdub25lXFwnO1wiIGFsbG93dHJhbnNwYXJlbmN5PjwvaWZyYW1lPlxcXG4gICAgICAgICAgICAgICAgPC9kaXY+XFxcbiAgICAgICAgICAgIDwvZGl2PlxcXG4gICAgICAgICcpO1xuXG4gICAgICAgIGlzT3BlbiA9IHRydWU7XG4gICAgfTtcblxuICAgIE1vZGFsLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJCgnYm9keScpLnJlbW92ZUNsYXNzKCdtb2R1bGFyaXR5LW1vZGFsLW9wZW4nKTtcbiAgICAgICAgJCgnI21vZHVsYXJpdHktbW9kYWwnKS5yZW1vdmUoKTtcbiAgICAgICAgaXNPcGVuID0gZmFsc2U7XG4gICAgfTtcblxuICAgIE1vZGFsLnByb3RvdHlwZS5oYW5kbGVFdmVudHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICdbZGF0YS1tb2R1bGFyaXR5LW1vZGFsLWFjdGlvbj1cImNsb3NlXCJdJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIG5ldyBNb2RhbCgpO1xuXG59KShqUXVlcnkpO1xuIiwiaW1wb3J0IFRoaWNrYm94IGZyb20gJy4vdGhpY2tib3guanMnO1xuaW1wb3J0IEhlbHBlcnMgZnJvbSAnLi4vaGVscGVycy9oZWxwZXJzLmpzJztcbmltcG9ydCBNb2RhbCBmcm9tICcuLi9wcm9tcHQvbW9kYWwuanMnO1xuXG5leHBvcnQgZGVmYXVsdCAoZnVuY3Rpb24gKCQpIHtcblxuICAgIHZhciBpbml0Q29tcGxldGVkID0gZmFsc2U7XG5cbiAgICAvKipcbiAgICAgKiBPYmplY3QgdG8gY3JlYXRlIFRoaWNrYm94IHF1ZXJ5c3RyaW5nIGZyb21cbiAgICAgKiBAdHlwZSB7T2JqZWN0fVxuICAgICAqL1xuICAgIHZhciB0aGlja2JveE9wdGlvbnMgPSB7XG4gICAgICAgIGlzX3RoaWNrYm94OiB0cnVlLFxuICAgIH07XG5cbiAgICB2YXIgZWRpdGluZ01vZHVsZSA9IGZhbHNlO1xuXG4gICAgZnVuY3Rpb24gTW9kdWxlKCkge1xuICAgICAgICAkKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHBhZ2Vub3cgIT09ICd1bmRlZmluZWQnICYmIHBhZ2Vub3cgPT0gJ2FkbWluX3BhZ2VfbW9kdWxhcml0eS1lZGl0b3InKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVFdmVudHMoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmxvYWRNb2R1bGVzKG1vZHVsYXJpdHlfcG9zdF9pZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTG9hZHMgc2F2ZWQgbW9kdWxlcyBhbmQgYWRkcyB0aGVtIHRvIHRoZSBwYWdlXG4gICAgICogQHBhcmFtICB7aW50ZWdlcn0gcG9zdElkIFRoZSBwb3N0IGlkIHRvIGxvYWQgbW9kdWxlcyBmcm9tXG4gICAgICogQHJldHVybiB7dm9pZH1cbiAgICAgKi9cbiAgICBNb2R1bGUucHJvdG90eXBlLmxvYWRNb2R1bGVzID0gZnVuY3Rpb24gKHBvc3RJZCkge1xuICAgICAgICB2YXIgcmVxdWVzdCA9IHtcbiAgICAgICAgICAgIGFjdGlvbjogJ2dldF9wb3N0X21vZHVsZXMnLFxuICAgICAgICAgICAgaWQ6IHBvc3RJZFxuICAgICAgICB9O1xuXG4gICAgICAgICQucG9zdChhamF4dXJsLCByZXF1ZXN0LCBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICQuZWFjaChyZXNwb25zZSwgZnVuY3Rpb24gKHNpZGViYXIsIG1vZHVsZXMpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2lkZWJhckVsZW1lbnQgPSAkKCcubW9kdWxhcml0eS1zaWRlYmFyLWFyZWFbZGF0YS1hcmVhLWlkPVwiJyArIHNpZGViYXIgKyAnXCJdJyk7XG5cbiAgICAgICAgICAgICAgICAkLmVhY2gobW9kdWxlcy5tb2R1bGVzLCBmdW5jdGlvbiAoa2V5LCBkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmhpZGRlbiA9PSAndHJ1ZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuaGlkZGVuID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHZhciBpbmNvbXBhYmlsaXR5ID0gKHR5cGVvZiBkYXRhLnNpZGViYXJfaW5jb21wYWJpbGl0eSAhPSAndW5kZWZpbmVkJyAmJiAhJC5pc0VtcHR5T2JqZWN0KGRhdGEuc2lkZWJhcl9pbmNvbXBhYmlsaXR5KSkgPyBKU09OLnN0cmluZ2lmeShkYXRhLnNpZGViYXJfaW5jb21wYWJpbGl0eSkgOiAnJztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRNb2R1bGUoc2lkZWJhckVsZW1lbnQsIGRhdGEucG9zdF90eXBlLCBkYXRhLnBvc3RfdHlwZV9uYW1lLCBkYXRhLnBvc3RfdGl0bGUsIGRhdGEuSUQsIGRhdGEuaGlkZGVuLCBkYXRhLmNvbHVtbldpZHRoLCBkYXRhLmlzRGVwcmVjYXRlZCwgaW5jb21wYWJpbGl0eSk7XG4gICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcblxuICAgICAgICAgICAgICAgIHNpZGViYXJFbGVtZW50LnJlbW92ZUNsYXNzKCdtb2R1bGFyaXR5LXNwaW5uZXInKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgICAgICAgICAgIHRoaXMuaW5pdENvbXBsZXRlZCA9IHRydWU7XG4gICAgICAgICAgICAkKCcubW9kdWxhcml0eS1zaWRlYmFyLWFyZWEnKS5yZW1vdmVDbGFzcygnbW9kdWxhcml0eS1zcGlubmVyJyk7XG4gICAgICAgIH0uYmluZCh0aGlzKSwgJ2pzb24nKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQ2hlY2sgZWRpdGluZyBtb2R1bGVcbiAgICAgKiBAcmV0dXJuIHtib29sZWFuL3N0cmluZ31cbiAgICAgKi9cbiAgICBNb2R1bGUucHJvdG90eXBlLmlzRWRpdGluZ01vZHVsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGVkaXRpbmdNb2R1bGU7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEdlbmVyYXRlcyBhIHRoaWNrYm94IHVybCB0byBvcGVuIGEgdGhpY2tib3ggaW4gY29ycmVjdCBtb2RlXG4gICAgICogQHBhcmFtICB7c3RyaW5nfSBhY3Rpb24gU2hvdWxkIGJlIFwiYWRkXCIgb3IgXCJlZGl0XCJcbiAgICAgKiBAcGFyYW0gIHtvYmplY3R9IGRhdGEgICBTaG91bGQgY29udGFpbiBhZGRpdGlvbmFsIGRhdGEgKGZvciBub3cgc3VwcG9ydHMgXCJwb3N0SWRcIiBhbmQgXCJwb3N0VHlwZVwiKVxuICAgICAqIEByZXR1cm4ge3N0cmluZ30gICAgICAgIFRoaWNrYm94IHVybFxuICAgICAqL1xuICAgIE1vZHVsZS5wcm90b3R5cGUuZ2V0VGhpY2tCb3hVcmwgPSBmdW5jdGlvbiAoYWN0aW9uLCBkYXRhKSB7XG4gICAgICAgIHZhciBiYXNlID0gJyc7XG4gICAgICAgIHZhciBxdWVyeXN0cmluZyA9IHt9O1xuXG4gICAgICAgIHN3aXRjaCAoYWN0aW9uKSB7XG4gICAgICAgICAgICBjYXNlICdhZGQnOlxuICAgICAgICAgICAgICAgIGJhc2UgPSAncG9zdC1uZXcucGhwJztcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAnZWRpdCc6XG4gICAgICAgICAgICAgICAgYmFzZSA9ICdwb3N0LnBocCc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZW9mIGRhdGEucG9zdElkID09ICdudW1iZXInKSB7XG4gICAgICAgICAgICBxdWVyeXN0cmluZy5wb3N0ID0gZGF0YS5wb3N0SWQ7XG4gICAgICAgICAgICBxdWVyeXN0cmluZy5hY3Rpb24gPSAnZWRpdCc7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZW9mIGRhdGEucG9zdFR5cGUgPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHF1ZXJ5c3RyaW5nLnBvc3RfdHlwZSA9IGRhdGEucG9zdFR5cGU7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYWRtaW5fdXJsICsgYmFzZSArICc/JyArICQucGFyYW0ocXVlcnlzdHJpbmcpICsgJyYnICsgJC5wYXJhbSh0aGlja2JveE9wdGlvbnMpO1xuICAgIH07XG5cbiAgICBNb2R1bGUucHJvdG90eXBlLmdldEltcG9ydFVybCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIHZhciBiYXNlID0gJ2VkaXQucGhwJztcbiAgICAgICAgdmFyIHF1ZXJ5c3RyaW5nID0ge307XG5cbiAgICAgICAgcXVlcnlzdHJpbmcucG9zdF90eXBlID0gZGF0YS5wb3N0VHlwZTtcblxuICAgICAgICByZXR1cm4gYWRtaW5fdXJsICsgYmFzZSArICc/JyArICQucGFyYW0ocXVlcnlzdHJpbmcpICsgJyYnICsgJC5wYXJhbSh0aGlja2JveE9wdGlvbnMpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBBZGRzIGEgbW9kdWxlIFwicm93XCIgdG8gdGhlIHRhcmdldCBwbGFjZWhvbGRlclxuICAgICAqIEBwYXJhbSB7c2VsZWN0b3J9IHRhcmdldCAgIFRoZSB0YXJnZXQgc2VsZWN0b3JcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbW9kdWxlSWQgICBUaGUgbW9kdWxlIGlkIHNsdWdcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbW9kdWxlTmFtZSBUaGUgbW9kdWxlIG5hbWVcbiAgICAgKi9cbiAgICBNb2R1bGUucHJvdG90eXBlLmFkZE1vZHVsZSA9IGZ1bmN0aW9uICh0YXJnZXQsIG1vZHVsZUlkLCBtb2R1bGVOYW1lLCBtb2R1bGVUaXRsZSwgcG9zdElkLCBoaWRkZW4sIGNvbHVtbldpZHRoLCBpc0RlcHJlY2F0ZWQsIGluY29tcGFiaWxpdHkpIHtcbiAgICAgICAgbW9kdWxlVGl0bGUgPSAodHlwZW9mIG1vZHVsZVRpdGxlICE9ICd1bmRlZmluZWQnKSA/ICc6ICcgKyBtb2R1bGVUaXRsZSA6ICcnO1xuICAgICAgICBwb3N0SWQgPSAodHlwZW9mIHBvc3RJZCAhPSAndW5kZWZpbmVkJykgPyBwb3N0SWQgOiAnJztcbiAgICAgICAgY29sdW1uV2lkdGggPSAodHlwZW9mIGNvbHVtbldpZHRoICE9ICd1bmRlZmluZWQnKSA/IGNvbHVtbldpZHRoIDogJyc7XG4gICAgICAgIGRlcHJlY2F0ZWQgPSAoaXNEZXByZWNhdGVkID09PSB0cnVlKSA/ICc8c3BhbiBjbGFzcz1cIm1vZHVsYXJpdHktZGVwcmVjYXRlZFwiIHN0eWxlPVwiY29sb3I6I2ZmMDAwMDtcIj4oJyArIG1vZHVsYXJpdHlBZG1pbkxhbmd1YWdlLmRlcHJlY2F0ZWQgKyAnKTwvc3Bhbj4nIDogJyc7XG4gICAgICAgIGluY29tcGFiaWxpdHkgPSAodHlwZW9mIGluY29tcGFiaWxpdHkgIT0gJ3VuZGVmaW5lZCcpID8gaW5jb21wYWJpbGl0eSA6ICcnO1xuXG4gICAgICAgIC8vIEdldCB0aGlja2JveCB1cmxcbiAgICAgICAgdmFyIHRoaWNrYm94VXJsID0gdGhpcy5nZXRUaGlja0JveFVybCgnYWRkJywge1xuICAgICAgICAgICAgcG9zdFR5cGU6IG1vZHVsZUlkXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFNldCB0aGlja2JveCBhY3Rpb25cbiAgICAgICAgVGhpY2tib3gucG9zdEFjdGlvbiA9ICdhZGQnO1xuXG4gICAgICAgIGlmIChwb3N0SWQpIHtcbiAgICAgICAgICAgIHRoaWNrYm94VXJsID0gdGhpcy5nZXRUaGlja0JveFVybCgnZWRpdCcsIHtcbiAgICAgICAgICAgICAgICBwb3N0SWQ6IHBvc3RJZFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIFRoaWNrYm94LnBvc3RBY3Rpb24gPSAnZWRpdCc7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBHZXQgaW1wb3J0IHVybFxuICAgICAgICB2YXIgaW1wb3J0VXJsID0gdGhpcy5nZXRJbXBvcnRVcmwoe1xuICAgICAgICAgICAgcG9zdFR5cGU6IG1vZHVsZUlkXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIENoZWNrL3VuY2hlY2sgaGlkZGVuIGNoZWNrYm94XG4gICAgICAgIHZhciBpc0hpZGRlbiA9ICcnO1xuICAgICAgICBpZiAoaGlkZGVuID09PSB0cnVlKSB7XG4gICAgICAgICAgICBpc0hpZGRlbiA9ICdjaGVja2VkJztcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBzaWRlYmFySWQgPSAkKHRhcmdldCkuZGF0YSgnYXJlYS1pZCcpO1xuICAgICAgICB2YXIgaXRlbVJvd0lkID0gSGVscGVycy51dWlkKCk7XG5cbiAgICAgICAgdmFyIGh0bWwgPSAnPGxpIGlkPVwicG9zdC0nICsgcG9zdElkICsgJ1wiIGRhdGEtbW9kdWxlLWlkPVwiJyArIG1vZHVsZUlkICsgJ1wiIGRhdGEtbW9kdWxlLXN0b3JlZC13aWR0aD1cIicgKyBjb2x1bW5XaWR0aCArICdcIiBkYXRhLXNpZGViYXItaW5jb21wYWJpbGl0eT1cXCcnICsgaW5jb21wYWJpbGl0eSArICdcXCc+XFxcbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cIm1vZHVsYXJpdHktbGluZS13cmFwcGVyXCI+XFxcbiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJtb2R1bGFyaXR5LXNvcnRhYmxlLWhhbmRsZVwiPjwvc3Bhbj5cXFxuICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cIm1vZHVsYXJpdHktbW9kdWxlLW5hbWVcIj5cXFxuICAgICAgICAgICAgICAgICAgICAgICAgJyArIG1vZHVsZU5hbWUgKyAnXFxcbiAgICAgICAgICAgICAgICAgICAgICAgICcgKyBkZXByZWNhdGVkICsgJ1xcXG4gICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cIm1vZHVsYXJpdHktbW9kdWxlLXRpdGxlXCI+JyArIG1vZHVsZVRpdGxlICsgJzwvc3Bhbj5cXFxuICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPVwibW9kdWxhcml0eS1tb2R1bGUtaGlkZVwiPlxcXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9XCJjaGVja2JveFwiIG5hbWU9XCJtb2R1bGFyaXR5X21vZHVsZXNbJyArIHNpZGViYXJJZCArICddWycgKyBpdGVtUm93SWQgKyAnXVtoaWRkZW5dXCIgdmFsdWU9XCJoaWRkZW5cIiAnICsgaXNIaWRkZW4gKyAnIC8+XFxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICsgbW9kdWxhcml0eUFkbWluTGFuZ3VhZ2UubGFuZ2hpZGUgKyAnXFxcbiAgICAgICAgICAgICAgICAgICAgICAgIDwvbGFiZWw+XFxcbiAgICAgICAgICAgICAgICAgICAgPC9zcGFuPlxcXG4gICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwibW9kdWxhcml0eS1tb2R1bGUtY29sdW1uc1wiPlxcXG4gICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWw+JyArIG1vZHVsYXJpdHlBZG1pbkxhbmd1YWdlLndpZHRoICsgJzo8L2xhYmVsPlxcXG4gICAgICAgICAgICAgICAgICAgICAgICA8c2VsZWN0IG5hbWU9XCJtb2R1bGFyaXR5X21vZHVsZXNbJyArIHNpZGViYXJJZCArICddWycgKyBpdGVtUm93SWQgKyAnXVtjb2x1bW5XaWR0aF1cIj5cXFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgKyBtb2R1bGFyaXR5QWRtaW5MYW5ndWFnZS53aWR0aE9wdGlvbnMgKyAnXFxcbiAgICAgICAgICAgICAgICAgICAgICAgIDwvc2VsZWN0PlxcXG4gICAgICAgICAgICAgICAgICAgIDwvc3Bhbj5cXFxuICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cIm1vZHVsYXJpdHktbW9kdWxlLWFjdGlvbnNcIj5cXFxuICAgICAgICAgICAgICAgICAgICAgICAgPGEgaHJlZj1cIicgKyB0aGlja2JveFVybCArICdcIiBkYXRhLW1vZHVsYXJpdHktbW9kYWwgY2xhc3M9XCJtb2R1bGFyaXR5LWpzLXRoaWNrYm94LW9wZW5cIj48c3Bhbj4nICsgbW9kdWxhcml0eUFkbWluTGFuZ3VhZ2UubGFuZ2VkaXQgKyAnPC9zcGFuPjwvYT5cXFxuICAgICAgICAgICAgICAgICAgICAgICAgPGEgaHJlZj1cIicgKyBpbXBvcnRVcmwgKyAnXCIgY2xhc3M9XCJtb2R1bGFyaXR5LWpzLXRoaWNrYm94LWltcG9ydFwiPjxzcGFuPicgKyBtb2R1bGFyaXR5QWRtaW5MYW5ndWFnZS5sYW5naW1wb3J0ICsgJzwvc3Bhbj48L2E+XFxcbiAgICAgICAgICAgICAgICAgICAgICAgIDxhIGhyZWY9XCIjcmVtb3ZlXCIgY2xhc3M9XCJtb2R1bGFyaXR5LW1vZHVsZS1yZW1vdmVcIj48c3Bhbj4nICsgbW9kdWxhcml0eUFkbWluTGFuZ3VhZ2UubGFuZ3JlbW92ZSArICc8L3NwYW4+PC9hPlxcXG4gICAgICAgICAgICAgICAgICAgIDwvc3Bhbj5cXFxuICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT1cImhpZGRlblwiIG5hbWU9XCJtb2R1bGFyaXR5X21vZHVsZXNbJyArIHNpZGViYXJJZCArICddWycgKyBpdGVtUm93SWQgKyAnXVtwb3N0aWRdXCIgY2xhc3M9XCJtb2R1bGFyaXR5LWpzLW1vZHVsZS1pZFwiIHZhbHVlPVwiJyArIHBvc3RJZCArICdcIiByZXF1aXJlZD5cXFxuICAgICAgICAgICAgICAgIDwvc3Bhbj5cXFxuICAgICAgICAgICAgPC9saT4nO1xuXG4gICAgICAgIC8vU3RvcmVcbiAgICAgICAgJCh0YXJnZXQpLmFwcGVuZChodG1sKTtcblxuICAgICAgICAvL1VwZGF0ZSB3aWR0aCBzZWxlY3RvclxuICAgICAgICAkKCcubW9kdWxhcml0eS1zaWRlYmFyLWFyZWEgPiBsaScpLmVhY2goZnVuY3Rpb24oaW5kZXgsIGl0ZW0pIHtcbiAgICAgICAgICAgICQoJy5tb2R1bGFyaXR5LW1vZHVsZS1jb2x1bW5zIHNlbGVjdCcsICQoaXRlbSkpLnZhbCgkKGl0ZW0pLmF0dHIoJ2RhdGEtbW9kdWxlLXN0b3JlZC13aWR0aCcpKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy9SZWZyZXNoXG4gICAgICAgICQoJy5tb2R1bGFyaXR5LWpzLXNvcnRhYmxlJykuc29ydGFibGUoJ3JlZnJlc2gnKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVXBkYXRlcyBhIG1vZHVsZSBcInJvd1wiIGFmdGVyIGVkaXRpbmcgdGhlIG1vZHVsZSBwb3N0XG4gICAgICogQHBhcmFtICB7RE9NfSBtb2R1bGUgICAgTW9kdWxlIGRvbSBlbGVtZW50XG4gICAgICogQHBhcmFtICB7b2JqZWN0fSBkYXRhICAgVGhlIGRhdGFcbiAgICAgKiBAcmV0dXJuIHt2b2lkfVxuICAgICAqL1xuICAgIE1vZHVsZS5wcm90b3R5cGUudXBkYXRlTW9kdWxlID0gZnVuY3Rpb24gKG1vZHVsZSwgZGF0YSkge1xuICAgICAgICAvLyBIcmVmXG4gICAgICAgIG1vZHVsZS5maW5kKCdhLm1vZHVsYXJpdHktanMtdGhpY2tib3gtb3BlbicpLmF0dHIoJ2hyZWYnLCB0aGlzLmdldFRoaWNrQm94VXJsKCdlZGl0Jywge1xuICAgICAgICAgICAgcG9zdElkOiBkYXRhLnBvc3RfaWRcbiAgICAgICAgfSkpO1xuXG4gICAgICAgIC8vIFBvc3QgaWQgaW5wdXRcbiAgICAgICAgbW9kdWxlLmZpbmQoJ2lucHV0Lm1vZHVsYXJpdHktanMtbW9kdWxlLWlkJykudmFsKGRhdGEucG9zdF9pZCkuY2hhbmdlKCk7XG5cbiAgICAgICAgLy8gUG9zdCB0aXRsZVxuICAgICAgICBtb2R1bGUuZmluZCgnLm1vZHVsYXJpdHktbW9kdWxlLXRpdGxlJykudGV4dCgnOiAnICsgZGF0YS50aXRsZSk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFJlbW92ZXMgYSBtb2R1bGUgXCJyb3dcIiBmcm9tIHRoZSBwbGFjZWhvbGRlclxuICAgICAqIEBwYXJhbSAge0RPTSBFbGVtZW50fSBtb2R1bGUgVGhlICh0byBiZSByZW1vdmVkKSBtb2R1bGUncyBkb20gZWxlbWVudFxuICAgICAqIEByZXR1cm4ge3ZvaWR9XG4gICAgICovXG4gICAgTW9kdWxlLnByb3RvdHlwZS5yZW1vdmVNb2R1bGUgPSBmdW5jdGlvbiAobW9kdWxlKSB7XG4gICAgICAgIGlmIChjb25maXJtKG1vZHVsYXJpdHlBZG1pbkxhbmd1YWdlLmFjdGlvblJlbW92ZSkpIHtcbiAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUoKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBIYW5kbGUgZXZlbnRzXG4gICAgICogQHJldHVybiB7dm9pZH1cbiAgICAgKi9cbiAgICBNb2R1bGUucHJvdG90eXBlLmhhbmRsZUV2ZW50cyA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAvLyBUcmFzaCBpY29uXG4gICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcubW9kdWxhcml0eS1tb2R1bGUtcmVtb3ZlJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHZhciB0YXJnZXQgPSAkKGUudGFyZ2V0KS5jbG9zZXN0KCdsaScpO1xuICAgICAgICAgICAgdGhpcy5yZW1vdmVNb2R1bGUodGFyZ2V0KTtcbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcblxuICAgICAgICAvL0ltcG9ydFxuICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLm1vZHVsYXJpdHktanMtdGhpY2tib3gtaW1wb3J0JywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgdmFyIGVsID0gJChlLnRhcmdldCkuY2xvc2VzdCgnYScpO1xuICAgICAgICAgICAgZWRpdGluZ01vZHVsZSA9ICQoZS50YXJnZXQpLmNsb3Nlc3QoJ2xpJyk7XG5cbiAgICAgICAgICAgIFRoaWNrYm94LnBvc3RBY3Rpb24gPSAnaW1wb3J0JztcbiAgICAgICAgICAgIE1vZGFsLm9wZW4oJChlLnRhcmdldCkuY2xvc2VzdCgnYScpLmF0dHIoJ2hyZWYnKSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEVkaXRcbiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5tb2R1bGFyaXR5LWpzLXRoaWNrYm94LW9wZW4nLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICB2YXIgZWwgPSAkKGUudGFyZ2V0KS5jbG9zZXN0KCdhJyk7XG4gICAgICAgICAgICBpZiAoZWwuYXR0cignaHJlZicpLmluZGV4T2YoJ3Bvc3QucGhwJykgPiAtMSkge1xuICAgICAgICAgICAgICAgIFRoaWNrYm94LnBvc3RBY3Rpb24gPSAnZWRpdCc7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGVkaXRpbmdNb2R1bGUgPSAkKGUudGFyZ2V0KS5jbG9zZXN0KCdsaScpO1xuICAgICAgICAgICAgTW9kYWwub3BlbigkKGUudGFyZ2V0KS5jbG9zZXN0KCdhJykuYXR0cignaHJlZicpKTtcbiAgICAgICAgICAgIFxuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH07XG5cbiAgICByZXR1cm4gbmV3IE1vZHVsZSgpO1xuXG59KShqUXVlcnkpO1xuIiwiZXhwb3J0IGRlZmF1bHQgKGZ1bmN0aW9uICgkKSB7XG5cbiAgICBmdW5jdGlvbiBBdXRvc2F2ZSgpIHtcbiAgICAgICAgJChmdW5jdGlvbigpe1xuICAgICAgICAgICAgLy90aGlzLmhhbmRsZUV2ZW50cygpO1xuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH1cblxuICAgIEF1dG9zYXZlLnByb3RvdHlwZS5zYXZlID0gZnVuY3Rpb24gKHNlbGVjdG9yKSB7XG4gICAgICAgICQoJyNtb2R1bGFyaXR5LW9wdGlvbnMgI3B1Ymxpc2hpbmctYWN0aW9uIC5zcGlubmVyJykuY3NzKCd2aXNpYmlsaXR5JywgJ3Zpc2libGUnKTtcbiAgICAgICAgdmFyIHJlcXVlc3QgPSAkKHNlbGVjdG9yKS5zZXJpYWxpemVPYmplY3QoKTtcbiAgICAgICAgcmVxdWVzdC5pZCA9IG1vZHVsYXJpdHlfcG9zdF9pZDtcbiAgICAgICAgcmVxdWVzdC5hY3Rpb24gPSAnc2F2ZV9tb2R1bGVzJztcblxuICAgICAgICAkLnBvc3QoYWpheHVybCwgcmVxdWVzdCwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAkKCcjbW9kdWxhcml0eS1vcHRpb25zICNwdWJsaXNoaW5nLWFjdGlvbiAuc3Bpbm5lcicpLmNzcygndmlzaWJpbGl0eScsICdoaWRkZW4nKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHJldHVybiBuZXcgQXV0b3NhdmUoKTtcblxufSkoalF1ZXJ5KTtcbiIsImltcG9ydCBUaGlja2JveCBmcm9tICcuLi9lZGl0b3IvdGhpY2tib3guanMnO1xuaW1wb3J0IE1vZHVsZSBmcm9tICcuLi9lZGl0b3IvbW9kdWxlLmpzJztcbmltcG9ydCBNb2RhbCBmcm9tICcuLi9wcm9tcHQvbW9kYWwuanMnO1xuXG5cbmV4cG9ydCBkZWZhdWx0IChmdW5jdGlvbiAoJCkge1xuXG4gICAgdmFyIGVkaXRpbmdXaWRnZXQgPSBmYWxzZTtcblxuICAgIGZ1bmN0aW9uIFdpZGdldCgpIHtcbiAgICAgICAgJChmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICAvKiBJbXBvcnQgKi9cbiAgICAgICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcubW9kdWxhcml0eS1qcy10aGlja2JveC13aWRnZXQtaW1wb3J0LXdpZGdldCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAgICAgZWRpdGluZ1dpZGdldCA9ICQoZS50YXJnZXQpLnBhcmVudHMoJy53aWRnZXQtaW5zaWRlJyk7XG5cbiAgICAgICAgICAgICAgICB2YXIgaW1wb3J0VXJsID0gTW9kdWxlLmdldEltcG9ydFVybCh7XG4gICAgICAgICAgICAgICAgICAgIHBvc3RUeXBlOiAkKGUudGFyZ2V0KS5wYXJlbnRzKCcud2lkZ2V0LWluc2lkZScpLmZpbmQoJy5tb2R1bGFyaXR5LXdpZGdldC1tb2R1bGUtdHlwZSBzZWxlY3QnKS52YWwoKVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgTW9kdWxlLmVkaXRpbmdNb2R1bGUgPSAkKGUudGFyZ2V0KS5jbG9zZXN0KCcud2lkZ2V0LWluc2lkZScpO1xuXG4gICAgICAgICAgICAgICAgVGhpY2tib3gucG9zdEFjdGlvbiA9ICdpbXBvcnQtd2lkZ2V0JztcbiAgICAgICAgICAgICAgICBNb2RhbC5vcGVuKGltcG9ydFVybCk7XG4gICAgICAgICAgICB9KTtcblxuXG4gICAgICAgICAgICAvKiBFZGl0ICovXG4gICAgICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLm1vZHVsYXJpdHktanMtdGhpY2tib3gtb3Blbi13aWRnZXQnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgICAgIHZhciBlbCA9ICQoZS50YXJnZXQpLmNsb3Nlc3QoJ2EnKTtcbiAgICAgICAgICAgICAgICBpZiAoZWwuYXR0cignaHJlZicpLmluZGV4T2YoJ3Bvc3QucGhwJykgPiAtMSkge1xuICAgICAgICAgICAgICAgICAgICBUaGlja2JveC5wb3N0QWN0aW9uID0gJ2VkaXQnO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnN0IGVkaXRpbmdNb2R1bGUgPSAkKGUudGFyZ2V0KS5jbG9zZXN0KCdsaScpO1xuXG4gICAgICAgICAgICAgICAgTW9kYWwub3BlbigkKGUudGFyZ2V0KS5jbG9zZXN0KCdhJykuYXR0cignaHJlZicpKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG5cblxuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH1cblxuICAgIFdpZGdldC5wcm90b3R5cGUuaXNFZGl0aW5nV2lkZ2V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZWRpdGluZ1dpZGdldDtcbiAgICB9O1xuXG4gICAgV2lkZ2V0LnByb3RvdHlwZS51cGRhdGVXaWRnZXQgPSBmdW5jdGlvbiAod2lkZ2V0LCBkYXRhKSB7XG4gICAgICAgICQod2lkZ2V0KS5maW5kKCcubW9kdWxhcml0eS13aWRnZXQtbW9kdWxlLWlkLXNwYW4nKS5odG1sKGRhdGEucG9zdF9pZCk7XG4gICAgICAgICQod2lkZ2V0KS5maW5kKCcubW9kdWxhcml0eS13aWRnZXQtbW9kdWxlLWlkJykudmFsKGRhdGEucG9zdF9pZCk7XG4gICAgICAgICQod2lkZ2V0KS5maW5kKCcubW9kdWxhcml0eS13aWRnZXQtbW9kdWxlLWVkaXQnKS5hdHRyKCdocmVmJywncG9zdC5waHA/cG9zdD0nICsgZGF0YS5wb3N0X2lkICsgJyZhY3Rpb249ZWRpdCZpc190aGlja2JveD10cnVlJykucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpO1xuICAgICAgICAkKHdpZGdldCkuZmluZCgnLm1vZHVsYXJpdHktd2lkZ2V0LW1vZHVsZS10aXRsZS1zcGFuJykuaHRtbChkYXRhLnRpdGxlKTtcbiAgICAgICAgJCh3aWRnZXQpLmZpbmQoJy5tb2R1bGFyaXR5LXdpZGdldC1tb2R1bGUtdGl0bGUnKS52YWwoZGF0YS50aXRsZSk7XG4gICAgfTtcblxuICAgIHJldHVybiBuZXcgV2lkZ2V0KCk7XG5cbn0pKGpRdWVyeSk7XG4iLCJtb2R1bGUuZXhwb3J0cyhmdW5jdGlvbiAoJCkge1xuXG4gICAgZnVuY3Rpb24gSGVscGVycygpIHtcbiAgICAgICAgJChmdW5jdGlvbigpe1xuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH1cblxuICAgIEhlbHBlcnMucHJvdG90eXBlLnV1aWQgPSBmdW5jdGlvbiAoc2VwYXJhdG9yKSB7XG4gICAgICAgIHJldHVybiBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSk7XG4gICAgfTtcblxuICAgIHJldHVybiBuZXcgSGVscGVycygpO1xuXG59KShqUXVlcnkpO1xuIiwiaW1wb3J0IFRoaWNrYm94IGZyb20gJy4vZWRpdG9yL3RoaWNrYm94LmpzJztcbmltcG9ydCBNb2R1bGUgZnJvbSAnLi9lZGl0b3IvbW9kdWxlLmpzJztcbmltcG9ydCBBdXRvc2F2ZSBmcm9tICcuL2VkaXRvci9hdXRvc2F2ZS5qcyc7XG5pbXBvcnQgTW9kYWwgZnJvbSAnLi9wcm9tcHQvbW9kYWwuanMnO1xuaW1wb3J0IFdpZGdldCBmcm9tICcuL2hlbHBlcnMvd2lkZ2V0LmpzJztcblxuZXhwb3J0IGRlZmF1bHQgKGZ1bmN0aW9uICgkKSB7XG4gICAgLyoqXG4gICAgICogQWRkIG5ldyBwb3N0IGNhbGxiYWNrXG4gICAgICovXG4gICAgaWYgKFRoaWNrYm94LnBvc3RBY3Rpb24gPT0gJ2FkZCcgJiYgbW9kdWxhcml0eV9wb3N0X2FjdGlvbiA9PSAnJykge1xuICAgICAgICBUaGlja2JveC5tb2R1bGVQb3N0Q3JlYXRlZChtb2R1bGFyaXR5X3Bvc3RfaWQpO1xuICAgIH1cbiAgICBcbiAgICBpZiAoVGhpY2tib3gucG9zdEFjdGlvbiA9PSAnZWRpdC1pbmxpbmUtc2F2ZWQnKSB7XG4gICAgICAgIHBhcmVudC5sb2NhdGlvbi5yZWxvYWQoKTtcbiAgICB9XG4gICAgXG4gICAgLyoqXG4gICAgICogRWRpdCBwb3N0IGNhbGxiYWNrXG4gICAgICovXG4gICAgaWYgKFRoaWNrYm94LnBvc3RBY3Rpb24gPT0gJ2VkaXQnICYmIG1vZHVsYXJpdHlfcG9zdF9hY3Rpb24gPT0gJycpIHtcbiAgICAgICAgalF1ZXJ5KGRvY3VtZW50KS5vbignY2xpY2snLCAnI3B1Ymxpc2gnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgVGhpY2tib3gucG9zdEFjdGlvbiA9ICdhZGQnO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgLyoqXG4gICAgICogRWRpdCBwb3N0IGNhbGxiYWNrXG4gICAgICovXG4gICAgaWYgKFRoaWNrYm94LnBvc3RBY3Rpb24gPT0gJ2VkaXQtaW5saW5lLW5vdC1zYXZlZCcpIHtcbiAgICAgICAgalF1ZXJ5KGRvY3VtZW50KS5vbignY2xpY2snLCAnI3B1Ymxpc2gnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgVGhpY2tib3gucG9zdEFjdGlvbiA9ICdlZGl0LWlubGluZS1zYXZlZCc7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICAvKipcbiAgICAgKiBJbXBvcnQgcG9zdCBtb2RpZmljYXRpb25zIGFuZCBjYWxsYmFja1xuICAgICAqL1xuICAgIGlmIChUaGlja2JveC5wb3N0QWN0aW9uID09ICdpbXBvcnQnKSB7XG4gICAgICAgICQoJy5jaGVjay1jb2x1bW4gaW5wdXRbdHlwZT1cImNoZWNrYm94XCJdJykucmVtb3ZlKCk7XG4gICAgICAgICQoJy53cC1saXN0LXRhYmxlJykuYWRkQ2xhc3MoJ21vZHVsYXJpdHktd3AtbGlzdC10YWJsZScpO1xuICAgICAgICAkKCd0Ym9keSAuY2hlY2stY29sdW1uJykuYWRkQ2xhc3MoJ21vZHVsYXJpdHktaW1wb3J0LWNvbHVtbicpLmFwcGVuZCgnPGJ1dHRvbiBjbGFzcz1cImJ1dHRvbiBtb2R1bGFyaXR5LWltcG9ydC1idXR0b25cIiBkYXRhLW1vZHVsYXJpdHktYWN0aW9uPVwiaW1wb3J0XCI+SW1wb3J0PC9idXR0b24+Jyk7XG4gICAgICAgICQoJyNwb3N0cy1maWx0ZXInKS5hcHBlbmQoJzxpbnB1dCB0eXBlPVwiaGlkZGVuXCIgbmFtZT1cImlzX3RoaWNrYm94XCIgdmFsdWU9XCJ0cnVlXCI+Jyk7XG4gICAgICAgIFxuICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnW2RhdGEtbW9kdWxhcml0eS1hY3Rpb249XCJpbXBvcnRcIl0nLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB2YXIgcG9zdElkID0gJChlLnRhcmdldCkuY2xvc2VzdCgndHInKS5hdHRyKCdpZCcpO1xuICAgICAgICAgICAgcG9zdElkID0gcG9zdElkLnNwbGl0KCctJylbMV07XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHZhciBtb2R1bGUgPSBNb2R1bGUuaXNFZGl0aW5nTW9kdWxlKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHZhciByZXF1ZXN0ID0ge1xuICAgICAgICAgICAgICAgIGFjdGlvbjogJ2dldF9wb3N0JyxcbiAgICAgICAgICAgICAgICBpZDogcG9zdElkXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAkKCdib2R5JykuYWRkQ2xhc3MoJ21vZHVsYXJpdHktbG9hZGVyLXRha2VvdmVyJyk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgICQucG9zdChhamF4dXJsLCByZXF1ZXN0LCBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgcG9zdF9pZDogcmVzcG9uc2UuSUQsXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5wb3N0X3RpdGxlXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBNb2R1bGUudXBkYXRlTW9kdWxlKG1vZHVsZSwgZGF0YSk7XG4gICAgICAgICAgICAgICAgQXV0b3NhdmUuc2F2ZSgnZm9ybScpO1xuICAgICAgICAgICAgICAgIE1vZGFsLmNsb3NlKCk7XG4gICAgICAgICAgICB9LCAnanNvbicpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgLyoqXG4gICAgICogSW1wb3J0IHBvc3QgbW9kaWZpY2F0aW9ucyBhbmQgY2FsbGJhY2tcbiAgICAgKi9cbiAgICBpZiAoVGhpY2tib3gucG9zdEFjdGlvbiA9PSAnaW1wb3J0LXdpZGdldCcpIHtcbiAgICAgICAgJCgnLmNoZWNrLWNvbHVtbiBpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl0nKS5yZW1vdmUoKTtcbiAgICAgICAgJCgnLndwLWxpc3QtdGFibGUnKS5hZGRDbGFzcygnbW9kdWxhcml0eS13cC1saXN0LXRhYmxlJyk7XG4gICAgICAgICQoJ3Rib2R5IC5jaGVjay1jb2x1bW4nKS5hZGRDbGFzcygnbW9kdWxhcml0eS1pbXBvcnQtY29sdW1uJykuYXBwZW5kKCc8YnV0dG9uIGNsYXNzPVwiYnV0dG9uIG1vZHVsYXJpdHktaW1wb3J0LWJ1dHRvblwiIGRhdGEtbW9kdWxhcml0eS1hY3Rpb249XCJpbXBvcnRcIj5JbXBvcnQ8L2J1dHRvbj4nKTtcbiAgICAgICAgXG4gICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICdbZGF0YS1tb2R1bGFyaXR5LWFjdGlvbj1cImltcG9ydFwiXScsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHZhciBwb3N0SWQgPSAkKGUudGFyZ2V0KS5jbG9zZXN0KCd0cicpLmF0dHIoJ2lkJyk7XG4gICAgICAgICAgICBwb3N0SWQgPSBwb3N0SWQuc3BsaXQoJy0nKVsxXTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdmFyIHdpZGdldCA9IFdpZGdldC5pc0VkaXRpbmdXaWRnZXQoKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSB7XG4gICAgICAgICAgICAgICAgYWN0aW9uOiAnZ2V0X3Bvc3QnLFxuICAgICAgICAgICAgICAgIGlkOiBwb3N0SWRcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBcbiAgICAgICAgICAgICQoJ2JvZHknKS5hZGRDbGFzcygnbW9kdWxhcml0eS1sb2FkZXItdGFrZW92ZXInKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgJC5wb3N0KGFqYXh1cmwsIHJlcXVlc3QsIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgICAgICBwb3N0X2lkOiByZXNwb25zZS5JRCxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLnBvc3RfdGl0bGVcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIFdpZGdldC51cGRhdGVXaWRnZXQod2lkZ2V0LCBkYXRhKTtcbiAgICAgICAgICAgICAgICBNb2RhbC5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgfSwgJ2pzb24nKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIFxufSkoalF1ZXJ5KTtcblxuXG5cbiJdLCJzb3VyY2VSb290IjoiIn0=