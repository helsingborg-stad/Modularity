var Modularity=Modularity||{};!function(o){o('input[type="checkbox"].sidebar-area-activator').on("click",function(t){var i=o(this).is(":checked"),e=o(this).attr("value");t.shiftKey&&(i?o('input.sidebar-area-activator[type="checkbox"][value="'+e+'"]').attr("checked",!0):o('input.sidebar-area-activator[type="checkbox"][value="'+e+'"]').attr("checked",!1))})}(jQuery),function(i){i("#modularity-options #publish").on("click",function(){i(this).siblings(".spinner").css("visibility","visible")}),i('a.wp-first-item[href="admin.php?page=modularity"]').parent("li").remove(),i("#modularity-tabs a").on("click",function(t){return wp.autosave&&(i(window).unbind(),wp.autosave.server.triggerSave(),i(document).ajaxComplete(function(){return!0})),!0})}(jQuery),jQuery(document).ready(function(i){var t;i("#modularity-mb-modules").length&&(t=i("#modularity-mb-modules").offset(),i(document).scroll(function(){i(window).scrollTop()+50>t.top&&!i("#modularity-mb-modules").hasClass("is-fixed")?i("#modularity-mb-modules").addClass("is-fixed"):i(window).scrollTop()+50<t.top&&i("#modularity-mb-modules").hasClass("is-fixed")&&i("#modularity-mb-modules").removeClass("is-fixed")})),i(".modularity-edit-module a").on("click",function(t){t.preventDefault(),Modularity.Editor.Thickbox.postAction="edit-inline-not-saved",Modularity.Prompt.Modal.open(i(t.target).closest("a").attr("href"))})}),jQuery(document).ready(function(t){t(".frontend-filter").hide(),"post"!==t("#modularity-latest-post-type select").val()&&"page"!==t("#modularity-latest-post-type select").val()||t(".frontend-filter").show(),t("body").on("change","#modularity-latest-post-type select",function(){"post"===t("#modularity-latest-post-type select").val()||"page"===t("#modularity-latest-post-type select").val()?t(".frontend-filter").show():t(".frontend-filter").hide()}).trigger("change")}),(Modularity=Modularity||{}).Editor=Modularity.Editor||{},Modularity.Editor.Autosave=function(e){function t(){e(function(){}.bind(this))}return t.prototype.save=function(t){e("#modularity-options #publishing-action .spinner").css("visibility","visible");var i=e(t).serializeObject();i.id=modularity_post_id,i.action="save_modules",e.post(ajaxurl,i,function(t){e("#modularity-options #publishing-action .spinner").css("visibility","hidden")})},new t}(jQuery),(Modularity=Modularity||{}).Editor=Modularity.Editor||{},Modularity.Editor.DragAndDrop=function(a){function t(){a(function(){"undefined"!=typeof pagenow&&"admin_page_modularity-editor"==pagenow&&this.init()}.bind(this))}return t.prototype.init=function(){this.setupDraggable(),this.setupDroppable(),this.setupSortable()},t.prototype.setupSortable=function(){a(".modularity-js-sortable").sortable({handle:".modularity-sortable-handle",connectWith:".modularity-js-sortable",placeholder:"ui-sortable-placeholder",start:function(t,i){try{var e=jQuery(i.item).attr("data-sidebar-incompability");(e=JSON.parse(e))&&"object"==typeof e&&jQuery(".modularity-sidebar-area").each(function(t,i){e.includes(jQuery(this).attr("data-area-id"))?jQuery(this).parent().parent().addClass("modularity-incompatible-area"):jQuery(this).parent().parent().removeClass("modularity-incompatible-area")})}catch(t){console.log("Incompability information not defined - "+t)}},stop:function(t,i){var o=i.item.parents("ul").data("area-id");i.item.find('input[name^="modularity_modules"]').each(function(t,i){var e=a(this).attr("name").replace(/\[(.*?)\]/i,"["+o+"]");a(this).attr("name",e)}),jQuery("[id^=modularity-mb-]").removeClass("modularity-incompatible-area")}}).bind(this)},t.prototype.setupDraggable=function(){a(".modularity-js-draggable").draggable({appendTo:"body",containment:"document",scroll:!1,helper:"clone",revert:"invalid",revertDuration:200,start:function(t,i){try{var e=jQuery(this).attr("data-sidebar-incompability");(e=JSON.parse(e))&&"object"==typeof e&&jQuery(".modularity-sidebar-area").each(function(t,i){e.includes(jQuery(this).attr("data-area-id"))?jQuery(this).parent().parent().addClass("modularity-incompatible-area"):jQuery(this).parent().parent().removeClass("modularity-incompatible-area")})}catch(t){console.log("Incompability information not defined - "+t)}},stop:function(t,i){jQuery("[id^=modularity-mb-]").removeClass("modularity-incompatible-area")}})},t.prototype.setupDroppable=function(){a(".modularity-js-droppable").droppable({accept:".modularity-js-draggable",hoverClass:"modularity-state-droppable",drop:function(t,i){this.appendModule(t,i)}.bind(this)}).bind(this)},t.prototype.appendModule=function(t,i){var e=i.draggable,o=e.find(".modularity-module-name").text(),a=e.data("module-id"),r=e.attr("data-sidebar-incompability");Modularity.Editor.Module.addModule(t.target,a,o,void 0,void 0,void 0,void 0,void 0,r)},new t}(jQuery),(Modularity=Modularity||{}).Editor=Modularity.Editor||{},Modularity.Editor.Module=function(h){var a={is_thickbox:!0},i=!1;function t(){h(function(){"undefined"!=typeof pagenow&&"admin_page_modularity-editor"==pagenow&&(this.handleEvents(),this.loadModules(modularity_post_id))}.bind(this))}return t.prototype.loadModules=function(t){var i={action:"get_post_modules",id:t};h.post(ajaxurl,i,function(t){h.each(t,function(t,i){var o=h('.modularity-sidebar-area[data-area-id="'+t+'"]');h.each(i.modules,function(t,i){"true"==i.hidden&&(i.hidden=!0);var e=void 0===i.sidebar_incompability||h.isEmptyObject(i.sidebar_incompability)?"":JSON.stringify(i.sidebar_incompability);this.addModule(o,i.post_type,i.post_type_name,i.post_title,i.ID,i.hidden,i.columnWidth,i.isDeprecated,e)}.bind(this)),o.removeClass("modularity-spinner")}.bind(this)),this.initCompleted=!0,h(".modularity-sidebar-area").removeClass("modularity-spinner")}.bind(this),"json")},t.prototype.isEditingModule=function(){return i},t.prototype.getThickBoxUrl=function(t,i){var e="",o={};switch(t){case"add":e="post-new.php";break;case"edit":e="post.php"}return"number"==typeof i.postId&&(o.post=i.postId,o.action="edit"),"string"==typeof i.postType&&(o.post_type=i.postType),admin_url+e+"?"+h.param(o)+"&"+h.param(a)},t.prototype.getImportUrl=function(t){var i={};return i.post_type=t.postType,admin_url+"edit.php?"+h.param(i)+"&"+h.param(a)},t.prototype.addModule=function(t,i,e,o,a,r,d,n,l){o=void 0!==o?": "+o:"",a=void 0!==a?a:"",d=void 0!==d?d:"",deprecated=!0===n?'<span class="modularity-deprecated" style="color:#ff0000;">('+modularityAdminLanguage.deprecated+")</span>":"",l=void 0!==l?l:"";var s=this.getThickBoxUrl("add",{postType:i});Modularity.Editor.Thickbox.postAction="add",a&&(s=this.getThickBoxUrl("edit",{postId:a}),Modularity.Editor.Thickbox.postAction="edit");var u=this.getImportUrl({postType:i}),p="";!0===r&&(p="checked");var c=h(t).data("area-id"),m=Modularity.Helpers.uuid(),y='<li id="post-'+a+'" data-module-id="'+i+'" data-module-stored-width="'+d+"\" data-sidebar-incompability='"+l+'\'>                <span class="modularity-line-wrapper">                    <span class="modularity-sortable-handle"></span>                    <span class="modularity-module-name">                        '+e+"                        "+deprecated+'                        <span class="modularity-module-title">'+o+'</span>                        <label class="modularity-module-hide">                            <input type="checkbox" name="modularity_modules['+c+"]["+m+'][hidden]" value="hidden" '+p+" />                            "+modularityAdminLanguage.langhide+'                        </label>                    </span>                    <span class="modularity-module-columns">                        <label>'+modularityAdminLanguage.width+':</label>                        <select name="modularity_modules['+c+"]["+m+'][columnWidth]">                            '+modularityAdminLanguage.widthOptions+'                        </select>                    </span>                    <span class="modularity-module-actions">                        <a href="'+s+'" data-modularity-modal class="modularity-js-thickbox-open"><span>'+modularityAdminLanguage.langedit+'</span></a>                        <a href="'+u+'" class="modularity-js-thickbox-import"><span>'+modularityAdminLanguage.langimport+'</span></a>                        <a href="#remove" class="modularity-module-remove"><span>'+modularityAdminLanguage.langremove+'</span></a>                    </span>                    <input type="hidden" name="modularity_modules['+c+"]["+m+'][postid]" class="modularity-js-module-id" value="'+a+'" required>                </span>            </li>';h(t).append(y),h(".modularity-sidebar-area > li").each(function(t,i){h(".modularity-module-columns select",h(i)).val(h(i).attr("data-module-stored-width"))}),h(".modularity-js-sortable").sortable("refresh")},t.prototype.updateModule=function(t,i){t.find("a.modularity-js-thickbox-open").attr("href",this.getThickBoxUrl("edit",{postId:i.post_id})),t.find("input.modularity-js-module-id").val(i.post_id).change(),t.find(".modularity-module-title").text(": "+i.title)},t.prototype.removeModule=function(t){confirm(modularityAdminLanguage.actionRemove)&&t.remove()},t.prototype.handleEvents=function(){h(document).on("click",".modularity-module-remove",function(t){t.preventDefault();var i=h(t.target).closest("li");this.removeModule(i)}.bind(this)),h(document).on("click",".modularity-js-thickbox-import",function(t){t.preventDefault();h(t.target).closest("a");i=h(t.target).closest("li"),Modularity.Editor.Thickbox.postAction="import",Modularity.Prompt.Modal.open(h(t.target).closest("a").attr("href"))}),h(document).on("click",".modularity-js-thickbox-open",function(t){t.preventDefault(),-1<h(t.target).closest("a").attr("href").indexOf("post.php")&&(Modularity.Editor.Thickbox.postAction="edit"),i=h(t.target).closest("li"),Modularity.Prompt.Modal.open(h(t.target).closest("a").attr("href"))}.bind(this))},new t}(jQuery),(Modularity=Modularity||{}).Editor=Modularity.Editor||{},Modularity.Editor.Thickbox=function(o){function t(){}return t.prototype.modulePostCreated=function(t){Modularity.Prompt.Modal.close();var e=Modularity.Editor.Module.isEditingModule(),i={action:"get_post",id:t};o.post(ajaxurl,i,function(t){var i={post_id:t.ID,title:t.post_title};Modularity.Editor.Module.updateModule(e,i),Modularity.Editor.Autosave.save("form")},"json")},new t}(jQuery),(Modularity=Modularity||{}).Editor=Modularity.Editor||{},Modularity.Editor.Validate=function(e){var o=!1,a="validation-error";function t(){this.handleEvents()}return t.prototype.run=function(){o=!1,this.checkRequired()},t.prototype.checkRequired=function(){var t=e("[required]");t.removeClass(a),t.each(function(t,i){0===e(i).val().length&&(e(i).parents("li").addClass(a),e(i).one("change",function(t){e(t.target).parents("li").removeClass(a)}),o=!0)}.bind(this))},t.prototype.handleEvents=function(){e(document).on("click","#modularity-mb-editor-publish #publish",function(t){return this.run(),!o||(e("#modularity-mb-editor-publish .spinner").css("visibility","hidden"),!1)}.bind(this))},new t}(jQuery),(Modularity=Modularity||{}).Helpers=Modularity.Helpers||{},Modularity.Helpers=function(t){function i(){t(function(){}.bind(this))}return i.prototype.uuid=function(t){return Math.random().toString(36).substr(2,9)},new i}(jQuery),jQuery.fn.serializeObject=function(){var t={},i=this.serializeArray();return jQuery.each(i,function(){void 0!==t[this.name]?(t[this.name].push||(t[this.name]=[t[this.name]]),t[this.name].push(this.value||"")):t[this.name]=this.value||""}),t},(Modularity=Modularity||{}).Helpers=Modularity.Helpers||{},Modularity.Helpers.Widget=function(e){var o=!1;function t(){e(function(){e(document).on("click",".modularity-js-thickbox-widget-import-widget",function(t){t.preventDefault(),o=e(t.target).parents(".widget-inside");var i=Modularity.Editor.Module.getImportUrl({postType:e(t.target).parents(".widget-inside").find(".modularity-widget-module-type select").val()});Modularity.Editor.Module.editingModule=e(t.target).closest(".widget-inside"),Modularity.Editor.Thickbox.postAction="import-widget",Modularity.Prompt.Modal.open(i)}),e(document).on("click",".modularity-js-thickbox-open-widget",function(t){t.preventDefault(),-1<e(t.target).closest("a").attr("href").indexOf("post.php")&&(Modularity.Editor.Thickbox.postAction="edit"),editingModule=e(t.target).closest("li"),Modularity.Prompt.Modal.open(e(t.target).closest("a").attr("href"))}.bind(this))}.bind(this))}return t.prototype.isEditingWidget=function(){return o},t.prototype.updateWidget=function(t,i){e(t).find(".modularity-widget-module-id-span").html(i.post_id),e(t).find(".modularity-widget-module-id").val(i.post_id),e(t).find(".modularity-widget-module-edit").attr("href","post.php?post="+i.post_id+"&action=edit&is_thickbox=true").removeClass("hidden"),e(t).find(".modularity-widget-module-title-span").html(i.title),e(t).find(".modularity-widget-module-title").val(i.title)},new t}(jQuery),(Modularity=Modularity||{}).Prompt=Modularity.Prompt||{},Modularity.Prompt.Modal=function(i){function t(){this.handleEvents()}return t.prototype.open=function(t){i("body").addClass("modularity-modal-open").append('            <div id="modularity-modal">                <div class="modularity-modal-wrapper">                    <button class="modularity-modal-close" data-modularity-modal-action="close">&times; '+modularityAdminLanguage.close+'</button>                    <div class="modularity-modal-spinner-container" id="modularity-iframe-loader"><span class="modularity-modal-spinner"></span></div>                    <iframe class="modularity-modal-iframe" src="'+t+'" frameborder="0" onload="document.getElementById(\'modularity-iframe-loader\').style.display=\'none\';" allowtransparency></iframe>                </div>            </div>        '),0},t.prototype.close=function(){i("body").removeClass("modularity-modal-open"),i("#modularity-modal").remove(),0},t.prototype.handleEvents=function(){i(document).on("click",'[data-modularity-modal-action="close"]',function(t){t.preventDefault(),this.close()}.bind(this))},new t}(jQuery);