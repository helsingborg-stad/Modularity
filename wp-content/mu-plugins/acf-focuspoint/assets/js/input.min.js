!function(o){acf.fields.focuspoint=acf.field.extend({type:"focuspoint",$el:null,actions:{ready:"initialize",append:"initialize"},events:{'click a[data-name="add"]':"add",'click a[data-name="edit"]':"edit",'click a[data-name="remove"]':"remove",'change input[type="file"]':"change"},focus:function(){this.$el=this.$field.find(".acf-image-uploader"),this.o=acf.get_data(this.$el)},initialize:function(e){"basic"==this.o.uploader&&this.$el.closest("form").attr("enctype","multipart/form-data");var i=e.find('[data-name="acf-focuspoint-img-id"]'),t=e.find(".acf-focuspoint"),a=e.find(".acf-focuspoint-img"),e=e.find(".focuspoint-selection-layer");i.val(),t.data("preview_size"),a.get(0);e.on("click",function(e){var i=o(this).outerWidth(),t=o(this).outerHeight(),a=e.offsetX,e=e.offsetY,t=Math.round(100*(e/t*100+Number.EPSILON))/100,i=Math.round(100*(a/i*100+Number.EPSILON))/100;o(this).siblings(".focal-point-picker").css({top:t+"%",left:i+"%"}),$top=o(this).parents(".acf-focuspoint").children('[data-name="acf-focuspoint-top"]'),$left=o(this).parents(".acf-focuspoint").children('[data-name="acf-focuspoint-left"]'),$top.val(t).trigger("change"),$left.val(i).trigger("change")})},add:function(){var a=this,f=this.$field,n=acf.get_closest_field(this.$field,"repeater");acf.media.popup({title:acf._e("image","select"),mode:"select",type:"image",field:acf.get_field_key(f),multiple:n.exists(),library:this.o.library,mime_types:this.o.mime_types,select:function(e,i){if(0<i){var t=acf.get_field_key(f),i=f.closest(".acf-row");if(f=!1,i.nextAll(".acf-row:visible").each(function(){if(f=acf.get_field(t,o(this))){if(!f.find(".acf-image-uploader.has-value").exists())return!1;f=!1}}),!f){if(!(i=acf.fields.repeater.doFocus(n).add()))return!1;f=acf.get_field(t,i)}}a.doFocus(f),a.render(a.prepare(e))}})},prepare:function(e){var i={id:e.id,url:e.attributes.url};return leftVal=this.$el.find('[data-name="acf-focuspoint-left"]').val(),topVal=this.$el.find('[data-name="acf-focuspoint-top"]').val(),leftVal&&topVal?this.$el.find(".focal-point-picker").css({top:topVal+"%",left:leftVal+"%"}):this.$el.find(".focal-point-picker").css({top:"50%",left:"50%"}),this.$el.find(".focuspoint-image.no-image").removeClass("no-image").addClass("has-image"),acf.isset(e.attributes,"sizes",this.o.preview_size,"url")&&(i.url=e.attributes.sizes[this.o.preview_size].url),i},render:function(e){this.$el.find('[data-name="acf-focuspoint-img"]').attr("src",e.url),this.$el.find('[data-name="acf-focuspoint-img-id"]').val(e.id).trigger("change"),this.$el.addClass("has-value")},edit:function(){var t=this;acf.media.popup({title:acf._e("image","edit"),type:"image",button:acf._e("image","update"),mode:"edit",id:id,select:function(e,i){t.render(t.prepare(e)).trigger("change")}})},removeAttachment:function(){this.render(!1)},remove:function(){this.removeAttachment(),this.$el.find('[data-name="acf-focuspoint-top"]').val(""),this.$el.find('[data-name="acf-focuspoint-left"]').val(""),this.$el.find(".focuspoint-image.has-image").removeClass("has-image").addClass("no-image"),this.$el.removeClass("has-value").trigger("change")},change:function(e){this.$el.find('[data-name="acf-focuspoint-img-id"]').val(e.$el.val()).trigger("change")}}),void 0!==acf.add_action?acf.add_action("ready append",function(e){acf.get_fields({type:"focuspoint"},e).each(function(){acf.fields.focuspoint.initialize(e)})}):o(document).live("acf/setup_fields",function(e,i){o(i).find('.field[data-field_type="focuspoint"]').each(function(){initialize_field(o(this))})}),window.acf&&window.acf.addAction("render_block_preview/type=focuspoint",acf.fields.focuspoint.initialize)}(jQuery);